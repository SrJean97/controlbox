"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){function t(t){this.defaultContext=t}return t.prototype.map=function(t,e,r){return this.defaultContext.map(t,e,r)},t}(),e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,r)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function r(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function n(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],p=0,s=i.length;p<s;p++,o++)n[o]=i[p];return n}function o(t){return"function"==typeof t}function i(t){return"symbol"==typeof t||"object"==typeof t&&"[object Symbol]"===Object.prototype.toString.call(t)}var p=function(){function t(t,e){void 0===t&&(t=Symbol()),void 0===e&&(e=Symbol()),this.source=t,this.destination=e}return t.prototype.toString=function(){return"[MappingPair<"+this.source.toString()+", "+this.destination.toString()+">]"},t}(),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(p),u=function(){function e(e){this.configuration=e,this.defaultContext=new t(this)}return e.prototype.map=function(t,e,r){var n=this,o=this.configuration.getMapperFunction(t);return t instanceof s?this.mapArrayToObject(t,e,r):Array.isArray(e)?e.map((function(t){return o(t,r,n.defaultContext)})):o(e,r,this.defaultContext)},e.prototype.mapArrayToObject=function(t,e,r){return this.configuration.getMapperFunction(t)(e,r,this.defaultContext)},e}(),a=function(){function t(t){this.sourceMember=t}return t.prototype.ignore=function(){this._ignored=!0},t.prototype.isIgnored=function(){return this._ignored},t}(),c=function(){function t(t,e,r){this.destinationMember=t,this.typeMap=e,this._memberChain=[],this._valueTransformers=[],r&&this.applyInheritedPropertyMap(r)}return Object.defineProperty(t.prototype,"sourceMembers",{get:function(){return this._memberChain},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueTransformers",{get:function(){return this._valueTransformers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMapped",{get:function(){return this.ignored||this.canResolveValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canResolveValue",{get:function(){return!this.ignored},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isResolveConfigured",{get:function(){return null!=this.customMappingFunction},enumerable:!0,configurable:!0}),t.prototype.chainMembers=function(t){var e=this;t.forEach((function(t){return e._memberChain.push(t)}))},t.prototype.mapFrom=function(t){this.customMappingFunction=t,this.ignored=!1},t.prototype.mapFromUsing=function(t,e){this.mapFrom(t),this.pair=e},t.prototype.addValueTransformation=function(t){this._valueTransformers.push(t)},t.prototype.applyInheritedPropertyMap=function(t){var e;t.ignored&&!this.isResolveConfigured&&(this.ignored=!0),this.customMappingFunction=this.customMappingFunction||t.customMappingFunction,this.pair=this.pair||t.pair,this.condition=this.condition||t.condition,this.precondition=this.precondition||t.precondition,this.nullSubstitute=this.nullSubstitute||t.nullSubstitute,(e=this._valueTransformers).push.apply(e,t.valueTransformers),this._memberChain=0===this._memberChain.length?t._memberChain:this._memberChain},t}(),f=function(){function t(t,e){this.configurationProvider=t,this.typeMap=e}return t.prototype.createMapper=function(){var t=this,e=this.typeMap.customMapFunction;if(e)return e;var r=this.createDestinationFunc(),o=this.createAssignment(),i=this.createTransformerFn(n(this.typeMap.valueTransformers,this.typeMap.profile.valueTransformers));return function(e,n,p){var s=t.typeMap.subtypeMaps.find((function(t){return t.condition(e)}));if(s)return p.map(s.pair,e,n);var u=n||r(e);if(t.typeMap.beforeMapFunctions.forEach((function(t){return t(e,u,p)})),t.typeMap.implicitAutoMapping&&e)for(var a=0,c=Object.keys(e);a<c.length;a++){var f=c[a],h=t.typeMap.sourceMemberConfigs.get(f);if(!(null==h?void 0:h.isIgnored())){var y=t.typeMap.propertyMaps.get(f);y?y.canResolveValue&&!y.isResolveConfigured&&t.tryPropertyMap(y,y.destinationMember)(e,u,p):u[f]=i(e[f])}}for(var l=0,d=o;l<d.length;l++){(0,d[l])(e,u,p)}return t.typeMap.afterMapFunctions.forEach((function(t){return t(e,u,p)})),u}},t.prototype.createDestinationFunc=function(){var t=this;if(this.typeMap.customCtorFunction)return this.typeMap.customCtorFunction;if(o(this.typeMap.destinationType))return function(){return new t.typeMap.destinationType};if(i(this.typeMap.destinationType))return function(){return{}};throw new Error("Unable to create destination type")},t.prototype.createAssignment=function(){var t=this,e=[];return this.typeMap.propertyMaps.forEach((function(r){if(r.canResolveValue){var n=t.tryPropertyMap(r,r.destinationMember);e.push(n)}})),e},t.prototype.tryPropertyMap=function(t,e){var r=[this.buildValueResolver(t)];t.pair&&r.push(this.mapFunction(t.pair,e));var o=this.createTransformerFn(n(t.valueTransformers,this.typeMap.valueTransformers,this.typeMap.profile.valueTransformers));return function(i,p,s){if(!t.precondition||t.precondition(i,p)){var u=function(t,e,i){return n(r,[o]).reduce((function(t,r){return r(t,e,i)}),t)}(i,p,s);t.condition&&!t.condition(i,p)||function(t,r){t[e]=r}(p,u)}}},t.prototype.createTransformerFn=function(t){return function(e){return t.reduce((function(t,e){return e(t)}),e)}},t.prototype.mapFunction=function(t,e){var r=this.configurationProvider.findTypeMapFor(t);if(r)return r.hasDerivedTypesToInclude||r.seal(this.configurationProvider),function(r,n,o){return o.map(t,r,n?n[e]:null)};throw new Error("Missing map for mapping pair "+t.toString())},t.prototype.buildValueResolver=function(t){var e;if(t.customMappingFunction)e=function(e){return null==e?null:t.customMappingFunction(e)};else{if(!t.sourceMembers.length)throw new Error('Unable to detect source member for destination member "'+t.destinationMember.toString()+'"');e=function(e){return null==e?null:e[t.sourceMembers[0]]}}return function(r,n,o){var i=e(r,n,o);return null==i&&void 0!==t.nullSubstitute?"function"==typeof t.nullSubstitute?t.nullSubstitute(r):t.nullSubstitute:null==i?null:i}},t}(),h=function(){function t(t,e){this.types=t,this.profile=e,this.sourceType=this.types.source,this.destinationType=this.types.destination,this._propertyMaps=new Map,this._valueTransformers=[],this._includedBaseTypes=new Set,this._includedDerivedTypes=new Set,this._inheritedTypeMaps=new Set,this._beforeMapFunctions=new Set,this._afterMapFunctions=new Set,this._sourceMemberConfigs=new Map,this._subtypeMaps=[],this.sealed=!1}return Object.defineProperty(t.prototype,"propertyMaps",{get:function(){return this._propertyMaps},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subtypeMaps",{get:function(){return this._subtypeMaps},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapFunction",{get:function(){return this._mapFunction},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueTransformers",{get:function(){return this._valueTransformers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforeMapFunctions",{get:function(){return this._beforeMapFunctions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterMapFunctions",{get:function(){return this._afterMapFunctions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includedBaseTypes",{get:function(){return this._includedBaseTypes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includedDerivedTypes",{get:function(){return this._includedDerivedTypes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasDerivedTypesToInclude",{get:function(){return this._includedDerivedTypes.size>0||null!=this.destinationTypeOverride},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceMemberConfigs",{get:function(){return this._sourceMemberConfigs},enumerable:!0,configurable:!0}),t.prototype.addValueTransformation=function(t){this._valueTransformers.push(t)},t.prototype.includeBasePair=function(t){if(this.types===t)throw new Error("You cannot include a type map into itself.");this._includedBaseTypes.add(t)},t.prototype.includeDerivedPair=function(t){if(this.types===t)throw new Error("You cannot include a type map into itself.");this._includedDerivedTypes.add(t)},t.prototype.addPolymorphicMap=function(t,e){this._subtypeMaps.push({condition:t,pair:e})},t.prototype.addInheritedMap=function(t){this._inheritedTypeMaps.add(t)},t.prototype.addBeforeMap=function(t){this._beforeMapFunctions.add(t)},t.prototype.addAfterMap=function(t){this._afterMapFunctions.add(t)},t.prototype.seal=function(t){var e=this;this.sealed||(this.sealed=!0,this._inheritedTypeMaps.forEach((function(t){return e.applyInheritedTypeMap(t)})),this._mapFunction=new f(t,this).createMapper())},t.prototype.findOrCreatePropertyMapFor=function(t){var e=this._propertyMaps.get(t);return e||(e=new c(t),this.insertPropertyMap(e),e)},t.prototype.findOrCreateSourceMemberConfigFor=function(t){var e=this._sourceMemberConfigs.get(t);return e||(e=new a(t),this._sourceMemberConfigs.set(t,e),e)},t.prototype.insertPropertyMap=function(t){this._propertyMaps.set(t.destinationMember,t)},t.prototype.applyInheritedTypeMap=function(t){var e,r=this;t.propertyMaps.forEach((function(t){if(t.isMapped){var e=r._propertyMaps.get(t.destinationMember);e?e.applyInheritedPropertyMap(t):r.insertPropertyMap(new c(t.destinationMember,r,t))}})),t._beforeMapFunctions.forEach((function(t){return r._beforeMapFunctions.add(t)})),t._afterMapFunctions.forEach((function(t){return r._afterMapFunctions.add(t)})),(e=this._valueTransformers).unshift.apply(e,t.valueTransformers),t._sourceMemberConfigs.forEach((function(t){if(t.isIgnored()){var e=r._sourceMemberConfigs.get(t.sourceMember);e?e.ignore():r._sourceMemberConfigs.set(t.sourceMember,t)}}))},t}(),y=function(){function t(t,e){this.typeMapConfigs=t.typeMapConfigs,this.valueTransformers=t.valueTransformers.concat(e?e.valueTransformers:[])}return t.prototype.register=function(t){for(var e=0,r=this.typeMapConfigs;e<r.length;e++){var n=r[e];this.buildTypeMap(t,n)}},t.prototype.configure=function(t){for(var e=0,r=this.typeMapConfigs;e<r.length;e++){var n=r[e],o=t.findTypeMapFor(n.types);this.configureTypeMap(o,t)}},t.prototype.configureTypeMap=function(t,e){this.applyBaseMaps(t,t,e),this.applyDerivedMaps(t,t,e)},t.prototype.buildTypeMap=function(t,e){var r=new h(e.types,this);e.configure(r),t.registerTypeMap(r)},t.prototype.applyBaseMaps=function(t,e,r){for(var n=0,o=r.getIncludedTypeMaps(e.includedBaseTypes);n<o.length;n++){var i=o[n];i.includeDerivedPair(e.types),t.addInheritedMap(i),this.applyBaseMaps(t,i,r)}},t.prototype.applyDerivedMaps=function(t,e,r){for(var n=0,o=r.getIncludedTypeMaps(e.includedDerivedTypes);n<o.length;n++){var i=o[n];i.includeBasePair(e.types),i.addInheritedMap(t),this.applyDerivedMaps(t,i,r)}},t}(),l=function(){function t(t){this.types=t,this.sourceType=o(this.types.source)?this.types.source:null,this.destinationType=o(this.types.destination)?this.types.destination:null,this.valueTransformers=[],this.memberConfigurations=[],this.sourceMemberConfigurations=[],this.typeMapActions=[]}return t.prototype.configure=function(t){for(var e=0,r=this.typeMapActions;e<r.length;e++){(0,r[e])(t)}for(var n=0,o=this.memberConfigurations;n<o.length;n++){o[n].configure(t)}for(var i=0,p=this.sourceMemberConfigurations;i<p.length;i++){p[i].configure(t)}for(var s=0,u=this.valueTransformers;s<u.length;s++){var a=u[s];t.addValueTransformation(a)}},t.prototype.addTransform=function(t){return this.valueTransformers.push(t),this},t.prototype.convertUsing=function(t){this.typeMapActions.push((function(e){return e.customMapFunction=t}))},t.prototype.constructUsing=function(t){return this.typeMapActions.push((function(e){return e.customCtorFunction=t})),this},t.prototype.includeBase=function(t){return this.typeMapActions.push((function(e){return e.includeBasePair(t)})),this},t.prototype.include=function(t){return this.typeMapActions.push((function(e){return e.includeDerivedPair(t)})),this},t.prototype.mapSubtype=function(t,e){return this.typeMapActions.push((function(r){return r.addPolymorphicMap(e,t)})),this.include(t),this},t.prototype.beforeMap=function(t){return this.typeMapActions.push((function(e){return e.addBeforeMap(t)})),this},t.prototype.afterMap=function(t){return this.typeMapActions.push((function(e){return e.addAfterMap(t)})),this},t}(),d=function(){function t(t){this.destinationMember=t,this.propertyMapActions=[]}return t.prototype.configure=function(t){var e=t.findOrCreatePropertyMapFor(this.destinationMember);this.apply(e)},t.prototype.mapFrom=function(t){return this.sourceMember=t,this.propertyMapActions.push((function(e){return e.mapFrom(t)})),this},t.prototype.mapFromUsing=function(t,e){return this.propertyMapActions.push((function(r){return r.mapFromUsing(t,e)})),this},t.prototype.addTransform=function(t){return this.propertyMapActions.push((function(e){return e.addValueTransformation(t)})),this},t.prototype.condition=function(t){return this.propertyMapActions.push((function(e){return e.condition=t})),this},t.prototype.preCondition=function(t){return this.propertyMapActions.push((function(e){return e.precondition=t})),this},t.prototype.nullSubstitute=function(t){return this.propertyMapActions.push((function(e){return e.nullSubstitute=t})),this},t.prototype.ignore=function(){this.propertyMapActions.push((function(t){return t.ignored=!0}))},t.prototype.auto=function(){var t=this;return this.propertyMapActions.push((function(e){return e.chainMembers([t.destinationMember])})),this},t.prototype.apply=function(t){for(var e=0,r=this.propertyMapActions;e<r.length;e++){(0,r[e])(t)}},t}(),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.forMember=function(t,e){return this.forDestinationMember(t,e)},e.prototype.forDestinationMember=function(t,e,r){void 0===r&&(r=!1);var n=new d(t);return r&&n.auto(),this.memberConfigurations.push(n),e(n),this},e}(l),m=function(){function t(t){this.sourceMember=t,this.sourceMemberActions=[]}return t.prototype.ignore=function(){this.sourceMemberActions.push((function(t){return t.ignore()}))},t.prototype.configure=function(t){for(var e=t.findOrCreateSourceMemberConfigFor(this.sourceMember),r=0,n=this.sourceMemberActions;r<n.length;r++){(0,n[r])(e)}},t}(),g=function(t){function e(e){var r=t.call(this,e)||this;return r.typeMapActions.push((function(t){return t.implicitAutoMapping=!0})),r}return r(e,t),e.prototype.forMember=function(t,e){return this.forDestinationMember(t,e,!0)},e.prototype.forSourceMember=function(t,e){var r=new m(t);return e(r),this.sourceMemberConfigurations.push(r),this},e}(M),b=function(){function t(){this.typeMapConfigs=[],this.valueTransformers=[]}return t.prototype.createAutoMap=function(t,e){return this.configureMappingExpression(new g(t),e)},t.prototype.createMap=function(t,e){return void 0===e&&(e={}),this.configureMappingExpression(new M(t),e)},t.prototype.createStrictMap=function(t,e,r){return this.configureMappingExpression(new M(t),e,r)},t.prototype.configureMappingExpression=function(t,e,r){for(var n=0,o=Object.keys(e);n<o.length;n++){var i=o[n];r&&t.forMember(i,r),t.forMember(i,e[i])}return this.typeMapConfigs.push(t),t},t}(),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._profiles=[],e}return r(e,t),Object.defineProperty(e.prototype,"profiles",{get:function(){return this._profiles},enumerable:!0,configurable:!0}),e.prototype.createProfile=function(t,e){var r=new T(t);e(r),this.addProfile(r)},e.prototype.addProfile=function(t){this._profiles.push(t)},e}(b),T=function(t){function e(e){var r=t.call(this)||this;return r.profileName=e,r}return r(e,t),e}(b),_=function(){function t(t){this.mapConfigs=[],this.typeMapRegistry=new Map;var e=new v;t(e);var r=new y(e);this._profiles=[r].concat(e.profiles.map((function(t){return new y(t,e)}))),this.seal()}return t.prototype.createMapper=function(){return new u(this)},t.prototype.registerTypeMap=function(t){this.typeMapRegistry.set(t.types,t)},t.prototype.findTypeMapFor=function(t){return this.typeMapRegistry.get(t)},t.prototype.getIncludedTypeMaps=function(t){var e=this;return Array.from(t).map((function(t){var r=e.findTypeMapFor(t);if(r)return r;throw new Error("Undefined mapping pair")}))},t.prototype.getMapperFunction=function(t){var e=this.typeMapRegistry.get(t);if(!e)throw new Error("Unable to locate mapper for provided pair");return e.mapFunction},t.prototype.seal=function(){for(var t=this,e=0,r=this._profiles;e<r.length;e++){r[e].register(this)}for(var n=0,o=this._profiles;n<o.length;n++){o[n].configure(this)}this.typeMapRegistry.forEach((function(e){return e.seal(t)}))},t.prototype.getAllTypeMaps=function(){return Array.from(this.typeMapRegistry.values())},t}();exports.ArrayToObjectMappingPair=s,exports.Mapper=u,exports.MapperConfiguration=_,exports.MappingPair=p,exports.Profile=b,exports.isSymbol=i,exports.isType=o;
